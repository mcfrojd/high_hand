<!DOCTYPE html>
<html lang="sv">

<head>
    <title>HH ADMIN</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#f5b411">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <link rel="apple-touch-icon" href="images/icon-192.png">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('SW registered:', reg.scope))
                .catch(err => console.error('SW registration failed:', err));
        }
    </script>
</head>

<body>
    <header class="header">
        <img src="images/logo.png" alt="High Hand Logo" class="logo">
        <h1 class="title">High Hand Admin</h1>
        <button class="hamburger-btn">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </header>
    <div class="container">
        <div class="grid">
            <div class="row">
                <div class="cell half">
                    <label for="kort1">Kort 1 - Värde</label>
                    <select id="kort1">
                        <option value="a">Ess</option>
                        <option value="k">Kung</option>
                        <option value="q">Dam</option>
                        <option value="j">Knekt</option>
                        <option value="10">10</option>
                        <option value="9">9</option>
                        <option value="8">8</option>
                        <option value="7">7</option>
                        <option value="6">6</option>
                        <option value="5">5</option>
                        <option value="4">4</option>
                        <option value="3">3</option>
                        <option value="2">2</option>
                        <option value="nn">Baksida</option>
                    </select>
                </div>
                <div class="cell half">
                    <label for="farg1">Kort 1 - Färg</label>
                    <select id="farg1">
                        <option value="h">Hjärter</option>
                        <option value="r">Ruter</option>
                        <option value="k">Klöver</option>
                        <option value="s">Spader</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="cell half">
                    <label for="kort2">Kort 2 - Värde</label>
                    <select id="kort2">
                        <option value="a">Ess</option>
                        <option value="k">Kung</option>
                        <option value="q">Dam</option>
                        <option value="j">Knekt</option>
                        <option value="10">10</option>
                        <option value="9">9</option>
                        <option value="8">8</option>
                        <option value="7">7</option>
                        <option value="6">6</option>
                        <option value="5">5</option>
                        <option value="4">4</option>
                        <option value="3">3</option>
                        <option value="2">2</option>
                        <option value="nn">Baksida</option>
                    </select>
                </div>
                <div class="cell half">
                    <label for="farg2">Kort 2 - Färg</label>
                    <select id="farg2">
                        <option value="h">Hjärter</option>
                        <option value="r">Ruter</option>
                        <option value="k">Klöver</option>
                        <option value="s">Spader</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="cell half">
                    <label for="kort3">Kort 3 - Värde</label>
                    <select id="kort3">
                        <option value="a">Ess</option>
                        <option value="k">Kung</option>
                        <option value="q">Dam</option>
                        <option value="j">Knekt</option>
                        <option value="10">10</option>
                        <option value="9">9</option>
                        <option value="8">8</option>
                        <option value="7">7</option>
                        <option value="6">6</option>
                        <option value="5">5</option>
                        <option value="4">4</option>
                        <option value="3">3</option>
                        <option value="2">2</option>
                        <option value="nn">Baksida</option>
                    </select>
                </div>
                <div class="cell half">
                    <label for="farg3">Kort 3 - Färg</label>
                    <select id="farg3">
                        <option value="h">Hjärter</option>
                        <option value="r">Ruter</option>
                        <option value="k">Klöver</option>
                        <option value="s">Spader</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="cell half">
                    <label for="kort4">Kort 4 - Värde</label>
                    <select id="kort4">
                        <option value="a">Ess</option>
                        <option value="k">Kung</option>
                        <option value="q">Dam</option>
                        <option value="j">Knekt</option>
                        <option value="10">10</option>
                        <option value="9">9</option>
                        <option value="8">8</option>
                        <option value="7">7</option>
                        <option value="6">6</option>
                        <option value="5">5</option>
                        <option value="4">4</option>
                        <option value="3">3</option>
                        <option value="2">2</option>
                        <option value="nn">Baksida</option>
                    </select>
                </div>
                <div class="cell half">
                    <label for="farg4">Kort 4 - Färg</label>
                    <select id="farg4">
                        <option value="h">Hjärter</option>
                        <option value="r">Ruter</option>
                        <option value="k">Klöver</option>
                        <option value="s">Spader</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="cell half">
                    <label for="kort5">Kort 5 - Värde</label>
                    <select id="kort5">
                        <option value="a">Ess</option>
                        <option value="k">Kung</option>
                        <option value="q">Dam</option>
                        <option value="j">Knekt</option>
                        <option value="10">10</option>
                        <option value="9">9</option>
                        <option value="8">8</option>
                        <option value="7">7</option>
                        <option value="6">6</option>
                        <option value="5">5</option>
                        <option value="4">4</option>
                        <option value="3">3</option>
                        <option value="2">2</option>
                        <option value="nn">Baksida</option>
                    </select>
                </div>
                <div class="cell half">
                    <label for="farg5">Kort 5 - Färg</label>
                    <select id="farg5">
                        <option value="h">Hjärter</option>
                        <option value="r">Ruter</option>
                        <option value="k">Klöver</option>
                        <option value="s">Spader</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="cell three-quarters">
                    <label for="hand">Hand</label>
                    <select id="hand">
                        <option value="Royal Straight Flush">Royal</option>
                        <option value="Färgstege">Färgstege</option>
                        <option value="Fyrtal">Fyrtal</option>
                        <option value="Kåk">Kåk</option>
                        <option value="Färg">Färg</option>
                        <option value="Stege">Stege</option>
                        <option value="Triss">Triss</option>
                        <option value="Två Par">Två Par</option>
                        <option value="Ett Par">Ett Par</option>
                        <option value="100 kr frivillig sidopott">Sidopott</option>
                    </select>
                </div>
                <div class="cell quarter">
                    <label for="antal">Antal</label>
                    <input type="text" id="antal">
                </div>
            </div>
            <div class="row">
                <div class="cell full-width">
                    <label for="namn">Innehavare</label>
                    <input type="text" id="namn"></div>
            </div>
            <div class="row">
                <div class="cell full-width button-container">
                    <button id="resetButton" class="btn">Återställ</button>
                    <button id="saveButton" class="btn">Spara</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SHEET_ID = '1l20j_NhoLIYOtUDWhZfH6wdQ0Y2VsjdxaTf6Op_gd7s';
        const SHEET_NAME = 'data';
        const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

        async function saveValues() {
            const values = {
                kort1: document.getElementById('kort1').value + document.getElementById('farg1').value,
                kort2: document.getElementById('kort2').value + document.getElementById('farg2').value,
                kort3: document.getElementById('kort3').value + document.getElementById('farg3').value,
                kort4: document.getElementById('kort4').value + document.getElementById('farg4').value,
                kort5: document.getElementById('kort5').value + document.getElementById('farg5').value,
                hand: document.getElementById('hand').value,
                namn: document.getElementById('namn').value,
                antal: document.getElementById('antal').value
            };

            try {
                await fetch('https://script.google.com/macros/s/AKfycbyyusgV3d51JxTISz7jphomFxHecIRrNT9hOT_26S2y8LD3BFkMExAtrJ_182ocGvbNUg/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify(values)
                });
                setTimeout(loadVariables, 2000);
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function loadVariables() {
            try {
                const timestamp = new Date().getTime();
                const response = await fetch(`${SHEET_URL}&_=${timestamp}`);
                const text = await response.text();
                const data = JSON.parse(text.substring(47).slice(0, -2));

                // Get last row from sheet
                const lastRowIndex = data.table.rows.length - 1;
                const row = data.table.rows[lastRowIndex];

                if (!row || !row.c) {
                    console.error('No data found in sheet');
                    return {};
                }

                return {
                    kort1: row.c[0]?.v || '',
                    kort2: row.c[1]?.v || '',
                    kort3: row.c[2]?.v || '',
                    kort4: row.c[3]?.v || '',
                    kort5: row.c[4]?.v || '',
                    hand: row.c[5]?.v || '',
                    namn: row.c[6]?.v || '',
                    antal: row.c[7]?.v || ''
                };
            } catch (error) {
                console.error('Error loading variables:', error);
                return {};
            }
        }

        async function initializeDropdowns() {
            try {
                const data = await loadVariables();

                // Set card values
                for (let i = 1; i <= 5; i++) {
                    const cardKey = `kort${i}`;
                    if (data[cardKey]) {
                        const value = data[cardKey].slice(0, -1);  // Remove last character (suit)
                        const suit = data[cardKey].slice(-1);      // Get last character (suit)
                        document.getElementById(`kort${i}`).value = value;
                        document.getElementById(`farg${i}`).value = suit;
                    }
                }

                // Set hand type and player name
                if (data.hand) {
                    document.getElementById('hand').value = data.hand;
                }
                if (data.innehavare) {
                    document.getElementById('namn').value = data.namn;
                }
                if (data.antal) {
                    document.getElementById('antal').value = data.antal;
                }
            } catch (error) {
                console.error('Error initializing dropdowns:', error);
            }
        }

        // Remove existing event listeners
        for (let i = 1; i <= 5; i++) {
            document.getElementById(`kort${i}`);
            document.getElementById(`farg${i}`);
        }
        document.getElementById('hand');
        document.getElementById('namn');
        document.getElementById('antal');

        // Add save button click handler
        document.getElementById('saveButton').addEventListener('click', saveValues);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initializeDropdowns);

        function resetValues() {
            // Reset card values
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`kort${i}`).value = 'nn';
                document.getElementById(`farg${i}`).value = 'h';
            }
            // Reset hand type and player name
            document.getElementById('hand').value = '100 kr frivillig sidopott';
            document.getElementById('namn').value = 'Antal anmälda: ';
            document.getElementById('antal').value = '0';
        }

        document.getElementById('resetButton').addEventListener('click', resetValues);
    </script>
</body>

</html>