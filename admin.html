<!DOCTYPE html>
<html>
    <head>
        <title>HIGH HAND ADMIN</title>
        <link rel="stylesheet" href="css/admin.css">
    </head>
<body class="admin-body">
    <div class="admin-container">
        <div class="all-cards-container">
            <!-- Card Block 1 -->
            <div class="card-block">
                <div class="dropdowns-container">
                    <div class="select-wrapper">
                        <label for="cardValue1">Kort 1 - Värde:</label>
                        <select id="cardValue1">
                            <option value="a">Ess</option>
                            <option value="k">Kung</option>
                            <option value="q">Dam</option>
                            <option value="j">Knekt</option>
                            <option value="10">10</option>
                            <option value="9">9</option>
                            <option value="8">8</option>
                            <option value="7">7</option>
                            <option value="6">6</option>
                            <option value="5">5</option>
                            <option value="4">4</option>
                            <option value="3">3</option>
                            <option value="2">2</option>
                            <option value="nn">Baksida</option>
                        </select>
                    </div>
                    <div class="select-wrapper">
                        <label for="cardSuit1">Kort 1 - Färg:</label>
                        <select id="cardSuit1">
                            <option value="h">Hjärter</option>
                            <option value="r">Ruter</option>
                            <option value="k">Klöver</option>
                            <option value="s">Spader</option>
                        </select>
                    </div>
                </div>
            </div>
            <!-- Card Block 2 -->
            <div class="card-block">
                <div class="dropdowns-container">
                    <div class="select-wrapper">
                        <label for="cardValue2">Kort 2 - Värde:</label>
                        <select id="cardValue2">
                            <option value="a">Ess</option>
                            <option value="k">Kung</option>
                            <option value="q">Dam</option>
                            <option value="j">Knekt</option>
                            <option value="10">10</option>
                            <option value="9">9</option>
                            <option value="8">8</option>
                            <option value="7">7</option>
                            <option value="6">6</option>
                            <option value="5">5</option>
                            <option value="4">4</option>
                            <option value="3">3</option>
                            <option value="2">2</option>
                            <option value="nn">Baksida</option>
                        </select>
                    </div>
                    <div class="select-wrapper">
                        <label for="cardSuit2">Kort 2 - Färg:</label>
                        <select id="cardSuit2">
                            <option value="h">Hjärter</option>
                            <option value="r">Ruter</option>
                            <option value="k">Klöver</option>
                            <option value="s">Spader</option>
                        </select>
                    </div>
                </div>
            </div>
            <!-- Card Block 3 -->
            <div class="card-block">
                <div class="dropdowns-container">
                    <div class="select-wrapper">
                        <label for="cardValue3">Kort 3 - Värde:</label>
                        <select id="cardValue3">
                            <option value="a">Ess</option>
                            <option value="k">Kung</option>
                            <option value="q">Dam</option>
                            <option value="j">Knekt</option>
                            <option value="10">10</option>
                            <option value="9">9</option>
                            <option value="8">8</option>
                            <option value="7">7</option>
                            <option value="6">6</option>
                            <option value="5">5</option>
                            <option value="4">4</option>
                            <option value="3">3</option>
                            <option value="2">2</option>
                            <option value="nn">Baksida</option>
                        </select>
                    </div>
                    <div class="select-wrapper">
                        <label for="cardSuit3">Kort 3 - Färg:</label>
                        <select id="cardSuit3">
                            <option value="h">Hjärter</option>
                            <option value="r">Ruter</option>
                            <option value="k">Klöver</option>
                            <option value="s">Spader</option>
                        </select>
                    </div>
                </div>
            </div>
            <!-- Card Block 4 -->
            <div class="card-block">
                <div class="dropdowns-container">
                    <div class="select-wrapper">
                        <label for="cardValue4">Kort 4 - Värde:</label>
                        <select id="cardValue4">
                            <option value="a">Ess</option>
                            <option value="k">Kung</option>
                            <option value="q">Dam</option>
                            <option value="j">Knekt</option>
                            <option value="10">10</option>
                            <option value="9">9</option>
                            <option value="8">8</option>
                            <option value="7">7</option>
                            <option value="6">6</option>
                            <option value="5">5</option>
                            <option value="4">4</option>
                            <option value="3">3</option>
                            <option value="2">2</option>
                            <option value="nn">Baksida</option>
                        </select>
                    </div>
                    <div class="select-wrapper">
                        <label for="cardSuit4">Kort 4 - Färg:</label>
                        <select id="cardSuit4">
                            <option value="h">Hjärter</option>
                            <option value="r">Ruter</option>
                            <option value="k">Klöver</option>
                            <option value="s">Spader</option>
                        </select>
                    </div>
                </div>
            </div>
            <!-- Card Block 5 -->
            <div class="card-block">
                <div class="dropdowns-container">
                    <div class="select-wrapper">
                        <label for="cardValue5">Kort 5 - Värde:</label>
                        <select id="cardValue5">
                            <option value="a">Ess</option>
                            <option value="k">Kung</option>
                            <option value="q">Dam</option>
                            <option value="j">Knekt</option>
                            <option value="10">10</option>
                            <option value="9">9</option>
                            <option value="8">8</option>
                            <option value="7">7</option>
                            <option value="6">6</option>
                            <option value="5">5</option>
                            <option value="4">4</option>
                            <option value="3">3</option>
                            <option value="2">2</option>
                            <option value="nn">Baksida</option>
                        </select>
                    </div>
                    <div class="select-wrapper">
                        <label for="cardSuit5">Kort 5 - Färg:</label>
                        <select id="cardSuit5">
                            <option value="h">Hjärter</option>
                            <option value="r">Ruter</option>
                            <option value="k">Klöver</option>
                            <option value="s">Spader</option>
                        </select>
                    </div>
                </div>
            </div>
            <!-- Hand and Player Container -->
            <div class="card-block">
                <div class="dropdowns-container">
                    <div class="select-wrapper">
                        <label for="handType">Typ av hand:</label>
                        <select id="handType">
                            <option value="Royal Straight Flush">Royal Straight Flush</option>
                            <option value="Färgstege">Färgstege</option>
                            <option value="Fyrtal">Fyrtal</option>
                            <option value="Kåk">Kåk</option>
                            <option value="Färg">Färg</option>
                            <option value="Stege">Stege</option>
                            <option value="Triss">Triss</option>
                            <option value="Två Par">Två Par</option>
                            <option value="Ett Par">Ett Par</option>
                            <option value="Hand">Hand</option>
                        </select>
                    </div>
                    <div class="select-wrapper">
                        <label for="playerName">Innehavare:</label>
                        <input type="text" id="playerName" class="player-input">
                    </div>
                </div>
            </div>
            <div class="admin-button-container">
                <button id="resetButton" class="admin-reset-button">Återställ</button>
                <button id="saveButton" class="admin-save-button">SPARA</button>
            </div>

        </div>
    </div>

    <script>
        const SHEET_ID = '1l20j_NhoLIYOtUDWhZfH6wdQ0Y2VsjdxaTf6Op_gd7s';
        const SHEET_NAME = 'data';
        const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

        async function saveValues() {
            const values = {
                timestamp: new Date().toISOString(),
                kort1: document.getElementById('cardValue1').value + document.getElementById('cardSuit1').value,
                kort2: document.getElementById('cardValue2').value + document.getElementById('cardSuit2').value,
                kort3: document.getElementById('cardValue3').value + document.getElementById('cardSuit3').value,
                kort4: document.getElementById('cardValue4').value + document.getElementById('cardSuit4').value,
                kort5: document.getElementById('cardValue5').value + document.getElementById('cardSuit5').value,
                hand: document.getElementById('handType').value,
                innehavare: document.getElementById('playerName').value
            };

            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbyq5ROC6Nx2zpSzbX6beO7KnjaKwaKoi8O5i2qEzthZucZAaG2sTtq2mmU3I_UeLPq4IA/exec', {
                    method: 'POST',
                    body: JSON.stringify(values)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save data');
                }
            } catch (error) {
                console.error('Error saving to sheet:', error);
            }
        }

        async function loadVariables() {
            try {
                const timestamp = new Date().getTime();
                const response = await fetch(`${SHEET_URL}&_=${timestamp}`);
                const text = await response.text();
                const data = JSON.parse(text.substring(47).slice(0, -2));
                
                // Get last row from sheet
                const lastRowIndex = data.table.rows.length - 1;
                const row = data.table.rows[lastRowIndex];

                if (!row || !row.c) {
                    console.error('No data found in sheet');
                    return {};
                }

                return {
                    kort1: row.c[0]?.v || '',
                    kort2: row.c[1]?.v || '',
                    kort3: row.c[2]?.v || '',
                    kort4: row.c[3]?.v || '',
                    kort5: row.c[4]?.v || '',
                    hand: row.c[5]?.v || '',
                    innehavare: row.c[6]?.v || ''
                };
            } catch (error) {
                console.error('Error loading variables:', error);
                return {};
            }
        }

        async function initializeDropdowns() {
            try {
                const data = await loadVariables();
                
                // Set card values
                for (let i = 1; i <= 5; i++) {
                    const cardKey = `kort${i}`;
                    if (data[cardKey]) {
                        const value = data[cardKey].slice(0, -1);  // Remove last character (suit)
                        const suit = data[cardKey].slice(-1);      // Get last character (suit)
                        document.getElementById(`cardValue${i}`).value = value;
                        document.getElementById(`cardSuit${i}`).value = suit;
                    }
                }
                
                // Set hand type and player name
                if (data.hand) {
                    document.getElementById('handType').value = data.hand;
                }
                if (data.innehavare) {
                    document.getElementById('playerName').value = data.innehavare;
                }
            } catch (error) {
                console.error('Error initializing dropdowns:', error);
            }
        }

        // Remove existing event listeners
        for (let i = 1; i <= 5; i++) {
            document.getElementById(`cardValue${i}`);
            document.getElementById(`cardSuit${i}`);
        }
        document.getElementById('handType');
        document.getElementById('playerName');

        // Add save button click handler
        document.getElementById('saveButton').addEventListener('click', saveValues);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initializeDropdowns);
        
    </script>
    <script>
        function resetValues() {
            // Reset card values
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`cardValue${i}`).value = 'nn';
                document.getElementById(`cardSuit${i}`).value = 'h';
            }
            // Reset hand type and player name
            document.getElementById('handType').value = 'Hand';
            document.getElementById('playerName').value = 'x';
        }

        document.getElementById('resetButton').addEventListener('click', resetValues);
    </script>
</body>
</html>